<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –û–ø—Ä–æ—Å–Ω–∏–∫</title>
    <!-- Tailwind CSS link for modern, responsive design -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Font and background settings */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }

        /* Custom styles for centering and shadow */
        .quiz-card {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 5px 10px -5px rgba(0, 0, 0, 0.04);
            transition: all 0.3s ease;
        }

        .answer-option {
            transition: all 0.15s ease-in-out;
            cursor: pointer;
        }

        .answer-option:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        /* Style for selected answers (checkbox/radio logic) */
        input:checked+.answer-label {
            border-color: #3b82f6;
            /* border-blue-500 */
            background-color: #eff6ff;
            /* bg-blue-50 */
        }
    </style>
</head>

<body class="flex items-center justify-center min-h-screen p-4">

    <!-- Main application container -->
    <div id="app-container" class="w-full max-w-xl">

        <!-- Quiz Card -->
        <div id="quiz-container" class="quiz-card bg-white p-6 md:p-8 rounded-xl">
            <h1 class="text-3xl font-bold text-gray-800 mb-6 border-b pb-3">–û—Ü–µ–Ω–∫–∞ –°–∞–º–æ—á—É–≤—Å—Ç–≤–∏—è</h1>
            <div id="questions-area" class="space-y-8">
                <!-- Questions will be generated here -->
            </div>

            <div id="error-message" class="text-red-500 mt-4 hidden">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã.
            </div>

            <button id="submit-quiz"
                class="w-full mt-8 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition duration-150 shadow-md shadow-blue-300">
                –ó–∞–≤–µ—Ä—à–∏—Ç—å –∏ –ü–æ–ª—É—á–∏—Ç—å –†–µ–∑—É–ª—å—Ç–∞—Ç—ã
            </button>
        </div>

        <!-- Results Card (Hidden by default) -->
        <div id="results-container" class="quiz-card bg-white p-6 md:p-8 rounded-xl hidden">
            <h1 class="text-3xl font-bold text-gray-800 mb-4 border-b pb-2">–í–∞—à–∏ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã</h1>

            <div id="global-score-section" class="mb-6 p-4 bg-gray-100 rounded-lg">
                <p class="text-sm font-medium text-gray-600">–û–±—â–∏–π –ò–Ω–¥–µ–∫—Å –°–∞–º–æ—á—É–≤—Å—Ç–≤–∏—è:</p>
                <p id="final-score" class="text-4xl font-extrabold text-blue-600 mt-1">...</p>
                <div id="global-recommendation" class="text-lg mt-2 text-gray-700">...</div>
            </div>

            <!-- Section for Detailed Answers -->
            <div id="detailed-answers-section" class="mb-8" style="display: none;">
                <h2 class="text-xl font-bold text-gray-800 mb-3 border-b-2 border-gray-200 pb-1">–ü–æ–¥—Ä–æ–±–Ω—ã–µ –û—Ç–≤–µ—Ç—ã</h2>
                <ul id="answers-list" class="space-y-4 text-gray-700 text-sm">
                    <!-- Detailed answers will be generated here -->
                </ul>
            </div>

            <div id="specific-recommendations-section">
                <h2 class="text-xl font-bold text-red-700 mb-3 border-b-2 border-red-100 pb-1">–û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ
                    –û–±–ª–∞—Å—Ç–∏</h2>
                <ul id="recommendations-list" class="space-y-3">
                    <!-- Specific recommendations will be generated here -->
                </ul>
                <p id="no-problems-message" class="text-green-600 font-medium hidden">–û—Ç–ª–∏—á–Ω–æ! –°–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –æ–±–ª–∞—Å—Ç–µ–π –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ.</p>
            </div>

            <!-- New Sharing Buttons (Print button removed) -->
            <div class="mt-8 pt-4 border-t border-gray-200 print-hidden">
                <div id="share-status" class="text-sm text-center mb-3 text-green-600 hidden"></div>

                <p class="text-sm text-gray-600 mb-3 font-medium">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Å –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–º:</p>

                <button id="copy-results"
                    class="w-full mb-3 py-3 bg-indigo-500 text-white font-semibold rounded-lg hover:bg-indigo-600 transition duration-150 shadow-md shadow-indigo-300 flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20"
                        fill="currentColor">
                        <path d="M7 9a2 2 0 012-2h6a2 2 0 012 2v6a2 2 0 01-2 2H9a2 2 0 01-2-2V9z" />
                        <path d="M5 3a2 2 0 00-2 2v6a2 2 0 002 2V5h8a2 2 0 00-2-2H5z" />
                    </svg>
                    –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç
                </button>
            </div>

            <button id="reset-quiz"
                class="w-full mt-8 py-2 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300 transition duration-150">
                –ù–∞—á–∞—Ç—å –°–Ω–æ–≤–∞
            </button>
        </div>

    </div>

    <!-- Hidden Template Area for Recommendations Content (New structure) -->
    <div id="template-area" class="hidden">

        <!-- === GLOBAL RECOMMENDATION TEMPLATES === -->
        <div id="global-rec-high">
            <h3 class="text-lg font-semibold mb-2">21+ –±–∞–ª–ª–æ–≤: –ë–∞–∑–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å –≥–∞—Ä–º–æ–Ω–∏–∏.</h3>
            <p class="text-base font-medium">–û—Ä–≥–∞–Ω–∏–∑–º –≤ —Ü–µ–ª–æ–º —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö —à–∞–≥–æ–≤ –∏ –ª—ë–≥–∫–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏.</p>
        </div>

        <div id="global-rec-medium">
            <h3 class="text-lg font-semibold mb-2">10--20 –±–∞–ª–ª–æ–≤: –ù–µ–æ–±—Ö–æ–¥–∏–º –ø–µ—Ä–≤—ã–π —à–∞–≥.</h3>
            <p class="text-base font-medium">–û—Ä–≥–∞–Ω–∏–∑–º —Å–∏–≥–Ω–∞–ª–∏—Ç –æ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–µ. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ–π—Ç–∏ –°oral Detox-Plus.</p>
        </div>

        <div id="global-rec-low">
            <h3 class="text-lg font-semibold mb-2">0--9 –±–∞–ª–ª–æ–≤: –ù–µ–æ–±—Ö–æ–¥–∏–º–∞ –ø–æ–ª–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞.</h3>
            <p class="text-base font-medium">–û—Ä–≥–∞–Ω–∏–∑–º –ø—Ä—è–º–æ –ø—Ä–æ—Å–∏—Ç –æ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–π –∑–∞–±–æ—Ç–µ. –õ—É—á—à–∏–π –≤–∞—Ä–∏–∞–Ω—Ç ‚Äî –ø—Ä–æ–π—Ç–∏ –≤—Å—é –ö–æ–Ω—Ü–µ–ø—Ü–∏—é –∑–¥–æ—Ä–æ–≤—å—è 2.0 –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ –∏ —ç–Ω–µ—Ä–≥–∏–∏ .</p>
        </div>

        <!-- === SPECIFIC RECOMMENDATION TEMPLATES === -->


        <div id="rec-ENERGY">
            <strong class="text-lg text-orange-700">–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —ç–Ω–µ—Ä–≥–∏–∏ –∏ –º–æ–∑–≥–∞:</strong>
            <p class="mt-1">–î–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è —Ç–æ–Ω—É—Å–∞ –∏ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏:</p>
            <ul class="list-disc ml-6 mt-1 text-sm">
                <li>üíä <b>H-500</b> (–ê–Ω—Ç–∏–æ–∫—Å–∏–¥–∞–Ω—Ç): –ü–æ–º–æ–≥–∞–µ—Ç –±–æ—Ä–æ—Ç—å—Å—è —Å–æ —Å–≤–æ–±–æ–¥–Ω—ã–º–∏ —Ä–∞–¥–∏–∫–∞–ª–∞–º–∏ –∏ –ø–æ–≤—ã—à–∞–µ—Ç –≤—ã—Ä–∞–±–æ—Ç–∫—É –∫–ª–µ—Ç–æ—á–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–∏.</li>
                <li>üíä <b>–í-Set</b> (–í–∏—Ç–∞–º–∏–Ω—ã –≥—Ä—É–ø–ø—ã –ë): –ù–µ–æ–±—Ö–æ–¥–∏–º—ã –¥–ª—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã –Ω–µ—Ä–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –∏ —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–º–µ–Ω–∞.</li>
                <li>üíß <b>–ü–µ–Ω—Ç–∞–ö–∞–Ω</b>: –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–∞–ª–∏–µ–≤–æ-–Ω–∞—Ç—Ä–∏–µ–≤—ã–π –±–∞–ª–∞–Ω—Å, –∂–∏–∑–Ω–µ–Ω–Ω–æ –≤–∞–∂–Ω—ã–π –¥–ª—è –∫–ª–µ—Ç–æ—á–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–∏.
                </li>
            </ul>
        </div>

        <div id="rec-SLEEP_STRESS">
            <strong class="text-lg text-orange-700">–ê–Ω—Ç–∏—Å—Ç—Ä–µ—Å—Å –∏ –∑–¥–æ—Ä–æ–≤—ã–π —Å–æ–Ω:</strong>
            <p class="mt-1">–î–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Å–Ω–∞, —Å–Ω–∏–∂–µ–Ω–∏—è —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç–∏ –∏ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è:</p>
            <ul class="list-disc ml-6 mt-1 text-sm">
                <li>üíä <b>–ö–æ—Ä–∞–ª –ú–∞–≥–Ω–∏–π</b> (Coral Magnesium): –ù–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏—è –º—ã—à—Ü –∏ –Ω–µ—Ä–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã.</li>
                <li>üíä <b>–ì—Ä–∏—Ñ—Ñ–æ–Ω–∏—è</b> (Griffonia): –ò—Å—Ç–æ—á–Ω–∏–∫ 5-HTP, –ø—Ä–µ–¥—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞ —Å–µ—Ä–æ—Ç–æ–Ω–∏–Ω–∞, –ø–æ–º–æ–≥–∞–µ—Ç —É–ª—É—á—à–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏ —Å–æ–Ω.</li>
                <li>üíä <b>–í–µ—á–µ—Ä–Ω—è—è —Ñ–æ—Ä–º—É–ª–∞</b> (Evening Formula): –ö–æ–º–ø–ª–µ–∫—Å –¥–ª—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–π —Ä–µ–≥—É–ª—è—Ü–∏–∏ —Å–Ω–∞.</li>
            </ul>
        </div>

        <div id="rec-DIGEST_DISCOMF">
            <strong class="text-lg text-orange-700">–ü–æ–º–æ—â—å –ø–∏—â–µ–≤–∞—Ä–µ–Ω–∏—é:</strong>
            <p class="mt-1">–ü—Ä–∏ –≤–∑–¥—É—Ç–∏–∏, —Ç—è–∂–µ—Å—Ç–∏ –∏ –¥–∏—Å–∫–æ–º—Ñ–æ—Ä—Ç–µ –ø–æ—Å–ª–µ –µ–¥—ã:</p>
            <ul class="list-disc ml-6 mt-1 text-sm">
                <li>üíä <b>–ê—Å—Å–∏–º–∏–ª—è—Ç–æ—Ä</b> (Assimilator): –ö–æ–º–ø–ª–µ–∫—Å –ø–∏—â–µ–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö —Ñ–µ—Ä–º–µ–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–≥–∞–µ—Ç —Ä–∞—Å—â–µ–ø–ª—è—Ç—å –ø–∏—â—É –∏ —Å–Ω–∏–º–∞—Ç—å —Ç—è–∂–µ—Å—Ç—å.</li>
                <li>üíä <b>–ö–æ—Ä–∞–ª –ê—Ä—Ç–∏—à–æ–∫</b> (Coral Artichoke): –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–µ—á–µ–Ω—å –∏ –æ—Ç—Ç–æ–∫ –∂–µ–ª—á–∏, —É–ª—É—á—à–∞—è –ø–∏—â–µ–≤–∞—Ä–µ–Ω–∏–µ.
                </li>
            </ul>
        </div>

        <div id="rec-DIGEST_CONSTIP">
            <strong class="text-lg text-orange-700">–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—É–ª–∞ –∏ –º–∏–∫—Ä–æ—Ñ–ª–æ—Ä—ã:</strong>
            <p class="mt-1">–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å–æ —Å—Ç—É–ª–æ–º (–∑–∞–ø–æ—Ä—ã):</p>
            <ul class="list-disc ml-6 mt-1 text-sm">
                <li>üíä <b>–°—É–ø–µ—Ä-–§–ª–æ—Ä–∞</b> (Super-Flora): –ö–æ–º–ø–ª–µ–∫—Å –ø—Ä–æ–±–∏–æ—Ç–∏–∫–æ–≤ –∏ –ø—Ä–µ–±–∏–æ—Ç–∏–∫–æ–≤ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∑–¥–æ—Ä–æ–≤–æ–π –º–∏–∫—Ä–æ—Ñ–ª–æ—Ä—ã –∫–∏—à–µ—á–Ω–∏–∫–∞.</li>
                <li>üíä <b>–ö–æ—Ä–∞–ª –ë—É—Ä–¥–æ–∫ –†—É—Ç</b> (Coral Burdock Root): –ü–æ–º–æ–≥–∞–µ—Ç –º—è–≥–∫–æ –æ—á–∏—â–∞—Ç—å –∫–∏—à–µ—á–Ω–∏–∫ –∏ —É–ª—É—á—à–∞—Ç—å –¥–µ—Ç–æ–∫—Å–∏–∫–∞—Ü–∏–æ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é.</li>
            </ul>
        </div>

        <div id="rec-IMMUNITY">
            <strong class="text-lg text-orange-700">–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–º–º—É–Ω–∏—Ç–µ—Ç–∞:</strong>
            <p class="mt-1">–ü—Ä–∏ —á–∞—Å—Ç—ã—Ö –ø—Ä–æ—Å—Ç—É–¥–∞—Ö –∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –∫–æ–∂–µ–π:</p>
            <ul class="list-disc ml-6 mt-1 text-sm">
                <li>üíä <b>–ö–æ—Ä–∞ –ú—É—Ä–∞–≤—å–∏–Ω–æ–≥–æ –î–µ—Ä–µ–≤–∞</b> (Pau D'Arco): –ü—Ä–∏—Ä–æ–¥–Ω—ã–π –∞–Ω—Ç–∏—Å–µ–ø—Ç–∏–∫ —Å –ø—Ä–æ—Ç–∏–≤–æ–≤–∏—Ä—É—Å–Ω—ã–º –∏ –ø—Ä–æ—Ç–∏–≤–æ–≥—Ä–∏–±–∫–æ–≤—ã–º –¥–µ–π—Å—Ç–≤–∏–µ–º.</li>
                <li>üíä <b>–ñ–∏—Ä –ø–µ—á–µ–Ω–∏ –∞–∫—É–ª—ã</b> (Shark Liver Oil): –ò—Å—Ç–æ—á–Ω–∏–∫ –∞–ª–∫–∏–ª–≥–ª–∏—Ü–µ—Ä–æ–ª–æ–≤, —Å—Ç–∏–º—É–ª–∏—Ä—É—é—â–∏—Ö –∏–º–º—É–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É.</li>
                <li>üíß <b>–ö–æ–ª–ª–æ–∏–¥–Ω–æ–µ –°–µ—Ä–µ–±—Ä–æ</b> (Silver-Max): –ú–æ—â–Ω–æ–µ —Å—Ä–µ–¥—Å—Ç–≤–æ –¥–ª—è –±–æ—Ä—å–±—ã —Å –ø–∞—Ç–æ–≥–µ–Ω–∞–º–∏.</li>
            </ul>
        </div>

        <div id="rec-WATER_LIFESTYLE">
            <strong class="text-lg text-orange-700">–í–æ–¥–Ω—ã–π –±–∞–ª–∞–Ω—Å –∏ –¥–≤–∏–∂–µ–Ω–∏–µ:</strong>
            <p class="mt-1">–ë–∞–∑–æ–≤—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã –¥–ª—è –æ–±—â–µ–≥–æ –∑–¥–æ—Ä–æ–≤—å—è:</p>
            <ul class="list-disc ml-6 mt-1 text-sm">
                <li>üíß <b>Coral-Mine</b>: –†–µ–≥—É–ª—è—Ä–Ω–æ–µ —É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞, —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ –º–∏–Ω–µ—Ä–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–∏—Ç—å–µ–≤–æ–π –≤–æ–¥—ã.</li>
                <li>üèÉ <b>–§–∏–∑–∏—á–µ—Å–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</b>: –ù–∞—á–Ω–∏—Ç–µ —Å –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö 30-–º–∏–Ω—É—Ç–Ω—ã—Ö –ø—Ä–æ–≥—É–ª–æ–∫ –¥–ª—è —Å—Ç–∏–º—É–ª—è—Ü–∏–∏ –ª–∏–º—Ñ–æ—Ç–æ–∫–∞ –∏ –æ–±–º–µ–Ω–∞ –≤–µ—â–µ—Å—Ç–≤.</li>
            </ul>
        </div>

        <div id="rec-BILIARY">
            <strong class="text-lg text-orange-700">–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∂–µ–ª—á–µ–æ—Ç—Ç–æ–∫–∞ (–ñ–ö–¢):</strong>
            <p class="mt-1">–ü—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –ø—Ä–æ–±–ª–µ–º —Å –∂–µ–ª—á–Ω—ã–º –ø—É–∑—ã—Ä–µ–º:</p>
            <ul class="list-disc ml-6 mt-1 text-sm">
                <li>üíä <b>–ö–æ—Ä–∞–ª –õ–µ—Ü–∏—Ç–∏–Ω</b> (Coral Lecithin): –ù–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ –∂–µ–ª—á–∏ –∏ –∑–∞—â–∏—Ç—ã –ø–µ—á–µ–Ω–∏.</li>
                <li>üíä <b>–ö–æ—Ä–∞–ª –ê—Ä—Ç–∏—à–æ–∫</b> (Coral Artichoke): –£–ª—É—á—à–∞–µ—Ç –æ—Ç—Ç–æ–∫ –∂–µ–ª—á–∏ –∏ –æ–±–ª–∞–¥–∞–µ—Ç –≥–µ–ø–∞—Ç–æ–ø—Ä–æ—Ç–µ–∫—Ç–æ—Ä–Ω—ã–º –¥–µ–π—Å—Ç–≤–∏–µ–º.</li>
            </ul>
        </div>

        <script>
            // === 1. QUIZ DATA ===
            // The main quiz structure
            const quizData = [
                // --- –ë–õ–û–ö: –≠–ù–ï–†–ì–ò–Ø, –°–û–ù, –°–¢–†–ï–°–° ---

                {
                    id: 'q1',
                    questionText: '–ß—É–≤—Å—Ç–≤—É–µ—Ç–µ –ª–∏ –í—ã –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ —ç–Ω–µ—Ä–≥–∏–∏, —É—Å—Ç–∞–ª–æ—Å—Ç—å –∏–ª–∏ —Ä–∞–∑–±–∏—Ç–æ—Å—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è?',
                    type: 'single',
                    category: 'ENERGY',
                    answers: [
                        { text: '–ù–∏–∫–æ–≥–¥–∞ –∏–ª–∏ –∫—Ä–∞–π–Ω–µ —Ä–µ–¥–∫–æ', value: 3, recommendationTag: null },
                        { text: '–†–µ–¥–∫–æ (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤ –º–µ—Å—è—Ü)', value: 2, recommendationTag: null },
                        { text: '–ò–Ω–æ–≥–¥–∞ (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é)', value: 1, recommendationTag: 'ENERGY' },
                        { text: '–ß–∞—Å—Ç–æ (–ø–æ—Å—Ç–æ—è–Ω–Ω–æ/–ø–æ—á—Ç–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å)', value: 0, recommendationTag: 'ENERGY' }
                    ]
                },
                {
                    id: 'q2',
                    questionText: '–ö–∞–∫ —á–∞—Å—Ç–æ –í—ã –∏—Å–ø—ã—Ç—ã–≤–∞–µ—Ç–µ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏ —Å –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏–µ–º –∏–ª–∏ –æ—â—É—â–∞–µ—Ç–µ, —á—Ç–æ –Ω–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª–∏—Å—å –ø–æ—Å–ª–µ —Å–Ω–∞?',
                    type: 'single',
                    category: 'SLEEP',
                    answers: [
                        { text: '–ù–∏–∫–æ–≥–¥–∞ –∏–ª–∏ –∫—Ä–∞–π–Ω–µ —Ä–µ–¥–∫–æ', value: 3, recommendationTag: null },
                        { text: '–†–µ–¥–∫–æ (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤ –º–µ—Å—è—Ü)', value: 2, recommendationTag: null },
                        { text: '–ò–Ω–æ–≥–¥–∞ (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é)', value: 1, recommendationTag: 'SLEEP_STRESS' },
                        { text: '–ß–∞—Å—Ç–æ (–ø–æ—Å—Ç–æ—è–Ω–Ω–æ/–ø–æ—á—Ç–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å)', value: 0, recommendationTag: 'SLEEP_STRESS' }
                    ]
                },
                {
                    id: 'q3',
                    questionText: '–ö–∞–∫ —á–∞—Å—Ç–æ –í—ã –æ—â—É—â–∞–µ—Ç–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ –≤ —Ç–µ–ª–µ, —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é –Ω–µ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∏–ª–∏ –ø–æ–≤—ã—à–µ–Ω–Ω—É—é —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å?',
                    type: 'single',
                    category: 'STRESS',
                    answers: [
                        { text: '–ù–∏–∫–æ–≥–¥–∞ –∏–ª–∏ –∫—Ä–∞–π–Ω–µ —Ä–µ–¥–∫–æ', value: 3, recommendationTag: null },
                        { text: '–†–µ–¥–∫–æ (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤ –º–µ—Å—è—Ü)', value: 2, recommendationTag: null },
                        { text: '–ò–Ω–æ–≥–¥–∞ (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é)', value: 1, recommendationTag: 'SLEEP_STRESS' },
                        { text: '–ß–∞—Å—Ç–æ (–ø–æ—Å—Ç–æ—è–Ω–Ω–æ/–ø–æ—á—Ç–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å)', value: 0, recommendationTag: 'SLEEP_STRESS' }
                    ]
                },
                // --- –ë–õ–û–ö: –ü–ò–©–ï–í–ê–†–ï–ù–ò–ï –ò –î–ï–¢–û–ö–° ---
                {
                    id: 'q4',
                    questionText: '–ö–∞–∫ —á–∞—Å—Ç–æ –ø–æ—Å–ª–µ –ø—Ä–∏—ë–º–∞ –ø–∏—â–∏ –í—ã —á—É–≤—Å—Ç–≤—É–µ—Ç–µ –¥–∏—Å–∫–æ–º—Ñ–æ—Ä—Ç, —Ç—è–∂–µ—Å—Ç—å, –≤–∑–¥—É—Ç–∏–µ –∏–ª–∏ –∏–∑–∂–æ–≥—É?',
                    type: 'single',
                    category: 'DIGESTION',
                    answers: [
                        { text: '–ù–∏–∫–æ–≥–¥–∞ –∏–ª–∏ –∫—Ä–∞–π–Ω–µ —Ä–µ–¥–∫–æ', value: 3, recommendationTag: null },
                        { text: '–†–µ–¥–∫–æ (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤ –º–µ—Å—è—Ü)', value: 2, recommendationTag: null },
                        { text: '–ò–Ω–æ–≥–¥–∞ (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é)', value: 1, recommendationTag: 'DIGEST_DISCOMF' },
                        { text: '–ß–∞—Å—Ç–æ (–ø–æ—Å—Ç–æ—è–Ω–Ω–æ/–ø–æ—á—Ç–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å)', value: 0, recommendationTag: 'DIGEST_DISCOMF' }
                    ]
                },
                {
                    id: 'q5',
                    questionText: '–ö–∞–∫ —á–∞—Å—Ç–æ —É –í–∞—Å —Å–ª—É—á–∞—é—Ç—Å—è –ø—Ä–æ–±–ª–µ–º—ã —Å–æ —Å—Ç—É–ª–æ–º (–∑–∞–ø–æ—Ä—ã - —Ä–µ–∂–µ 1 —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å, –∏–ª–∏ –¥–∏–∞—Ä–µ—è)?',
                    type: 'single',
                    category: 'DIGESTION',
                    answers: [
                        { text: '–ù–∏–∫–æ–≥–¥–∞ –∏–ª–∏ –∫—Ä–∞–π–Ω–µ —Ä–µ–¥–∫–æ (—Å—Ç—É–ª –µ–∂–µ–¥–Ω–µ–≤–Ω–æ)', value: 3, recommendationTag: null },
                        { text: '–†–µ–¥–∫–æ (–¥–æ 1 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é)', value: 2, recommendationTag: null },
                        { text: '–ò–Ω–æ–≥–¥–∞ (2-3 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é)', value: 1, recommendationTag: 'DIGEST_CONSTIP' },
                        { text: '–ß–∞—Å—Ç–æ (–ø–æ—Å—Ç–æ—è–Ω–Ω–æ/–ø–æ—á—Ç–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å)', value: 0, recommendationTag: 'DIGEST_CONSTIP' }
                    ]
                },
                // --- –ë–õ–û–ö: –ò–ú–ú–£–ù–ò–¢–ï–¢ –ò –í–ù–ò–ú–ê–ù–ò–ï ---
                {
                    id: 'q6',
                    questionText: '–ö–∞–∫ —á–∞—Å—Ç–æ –í—ã –±–æ–ª–µ–µ—Ç–µ –ø—Ä–æ—Å—Ç—É–¥–Ω—ã–º–∏ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è–º–∏ (—á–∞—â–µ 2-3 —Ä–∞–∑ –≤ –≥–æ–¥) –∏–ª–∏ –∏–º–µ–µ—Ç–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–∂–µ–π?',
                    type: 'single',
                    category: 'IMMUNITY',
                    answers: [
                        { text: '–ù–∏–∫–æ–≥–¥–∞ –∏–ª–∏ –∫—Ä–∞–π–Ω–µ —Ä–µ–¥–∫–æ', value: 3, recommendationTag: null },
                        { text: '–†–µ–¥–∫–æ (1-2 —Ä–∞–∑–∞ –≤ –≥–æ–¥)', value: 2, recommendationTag: null },
                        { text: '–ò–Ω–æ–≥–¥–∞ (3-4 —Ä–∞–∑–∞ –≤ –≥–æ–¥ –∏–ª–∏ –µ—Å—Ç—å –∫–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã)', value: 1, recommendationTag: 'IMMUNITY' },
                        { text: '–ß–∞—Å—Ç–æ (–ø–æ—Å—Ç–æ—è–Ω–Ω–æ/–ø–æ—á—Ç–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å)', value: 0, recommendationTag: 'IMMUNITY' }
                    ]
                },
                {
                    id: 'q7',
                    questionText: '–ù–∞—Å–∫–æ–ª—å–∫–æ —á–∞—Å—Ç–æ –í—ã –æ—Ç–º–µ—á–∞–µ—Ç–µ —Å–Ω–∏–∂–µ–Ω–∏–µ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏ –≤–Ω–∏–º–∞–Ω–∏—è –∏–ª–∏ "—Ç—É–º–∞–Ω –≤ –≥–æ–ª–æ–≤–µ"?',
                    type: 'single',
                    category: 'HEAD',
                    answers: [
                        { text: '–ù–∏–∫–æ–≥–¥–∞ –∏–ª–∏ –∫—Ä–∞–π–Ω–µ —Ä–µ–¥–∫–æ', value: 3, recommendationTag: null },
                        { text: '–†–µ–¥–∫–æ (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤ –º–µ—Å—è—Ü)', value: 2, recommendationTag: null },
                        { text: '–ò–Ω–æ–≥–¥–∞ (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é)', value: 1, recommendationTag: 'ENERGY' },
                        { text: '–ß–∞—Å—Ç–æ (–ø–æ—Å—Ç–æ—è–Ω–Ω–æ/–ø–æ—á—Ç–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å)', value: 0, recommendationTag: 'ENERGY' }
                    ]
                },

                // --- –ë–õ–û–ö: –§–ê–ö–¢–û–†–´ –†–ò–°–ö–ê (–î–∞/–ù–µ—Ç) ---

                {
                    id: 'q8',
                    questionText: '–ï—Å—Ç—å –ª–∏ —É –í–∞—Å –ø—Ä–æ–±–ª–µ–º—ã —Å –∂–µ–ª—á–Ω—ã–º –ø—É–∑—ã—Ä–µ–º (–∫–∞–º–Ω–∏, –ø–µ—Å–æ–∫, —É–¥–∞–ª–µ–Ω –∏–ª–∏ —Å–∏–ª—å–Ω—ã–π –∑–∞–≥–∏–±)?',
                    type: 'single',
                    category: 'RISK',
                    answers: [
                        { text: '–ù–µ—Ç', value: 3, recommendationTag: null },
                        { text: '–î–∞', value: 0, recommendationTag: 'BILIARY' } // –î–∞–µ–º 0 –±–∞–ª–ª–æ–≤ –∑–∞ –Ω–∞–ª–∏—á–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
                    ]
                },
                {
                    id: 'q9',
                    questionText: '–í—ã–ø–∏–≤–∞–µ—Ç–µ –ª–∏ –í—ã –º–µ–Ω–µ–µ 1,5 –ª–∏—Ç—Ä–∞ —á–∏—Å—Ç–æ–π –≤–æ–¥—ã –≤ –¥–µ–Ω—å?',
                    type: 'single',
                    category: 'LIFESTYLE',
                    answers: [
                        { text: '–ù–µ—Ç, –ø—å—é –±–æ–ª–µ–µ 1,5 –ª', value: 3, recommendationTag: null },
                        { text: '–î–∞, –ø—å—é –º–µ–Ω–µ–µ 1,5 –ª', value: 0, recommendationTag: 'WATER_LIFESTYLE' }
                    ]
                },
                {
                    id: 'q10',
                    questionText: '–£ –í–∞—Å –Ω–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (–º–µ–Ω–µ–µ 30 –º–∏–Ω 3-4 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é)?',
                    type: 'single',
                    category: 'LIFESTYLE',
                    answers: [
                        { text: '–ù–µ—Ç, –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è', value: 3, recommendationTag: null },
                        { text: '–î–∞, –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –Ω–∏–∑–∫–∞—è', value: 0, recommendationTag: 'WATER_LIFESTYLE' }
                    ]
                },
                {
                    id: 'qGen1',
                    questionText: '–í–∞—à–µ –∏–º—è: (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)',
                    type: 'text', // –¢–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ
                    category: 'GENERAL',
                    optional: true
                },
                {
                    id: 'qGen2',
                    questionText: '–°–∫–æ–ª—å–∫–æ –í–∞–º –ª–µ—Ç: (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)',
                    type: 'text', // –ß–∏—Å–ª–æ–≤–æ–µ –ø–æ–ª–µ
                    category: 'GENERAL',
                    optional: true
                },
                {
                    id: 'qGen3',
                    questionText: '–í–∞—à –≤–µ—Å (–∫–≥): (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)',
                    type: 'text', // –ß–∏—Å–ª–æ–≤–æ–µ –ø–æ–ª–µ
                    category: 'GENERAL',
                    optional: true
                },
                {
                    id: 'qGen4',
                    questionText: '–ö–∞–∫—É—é –æ—Å–Ω–æ–≤–Ω—É—é –∑–∞–¥–∞—á—É –ø–æ –∑–¥–æ—Ä–æ–≤—å—é –í—ã —Ö–æ—Ç–µ–ª–∏ –±—ã —Ä–µ—à–∏—Ç—å? (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)',
                    type: 'text', // –¢–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ
                    category: 'GENERAL',
                    optional: true
                }
            ];

            // Global score configuration, linking score ranges to template IDs
            const globalScoreConfig = [
                // Sorted descending by minPercentage
                {
                    minPercentage: 66,
                    colorClass: 'text-green-600',
                    templateId: 'global-rec-high'
                },
                {
                    minPercentage: 33,
                    colorClass: 'text-yellow-600',
                    templateId: 'global-rec-medium'
                },
                // Default/Lowest range
                {
                    minPercentage: 0,
                    colorClass: 'text-red-600',
                    templateId: 'global-rec-low'
                }
            ];


            // === 2. ELEMENT REFERENCES ===
        const questionsArea = document.getElementById('questions-area');
        const quizContainer = document.getElementById('quiz-container');
        const resultsContainer = document.getElementById('results-container');
        const submitButton = document.getElementById('submit-quiz');
        const resetButton = document.getElementById('reset-quiz');
        const errorMessage = document.getElementById('error-message');
        const finalScoreDisplay = document.getElementById('final-score');
        const globalRecommendationDisplay = document.getElementById('global-recommendation');
        const recommendationsList = document.getElementById('recommendations-list');
        const suggestionsContainer = document.getElementById('specific-recommendations-section');
        const templateArea = document.getElementById('template-area');
        const answersList = document.getElementById('answers-list');
        const detailedAnswersSection = document.getElementById('detailed-answers-section');
        const noProblemsMessage = document.getElementById('no-problems-message');
        
        // New element references for sharing
        const copyResultsButton = document.getElementById('copy-results');
        // printResultsButton - REMOVED
        const shareStatus = document.getElementById('share-status');

        // Global variable to store raw answers after submission for use in sharing
        let cachedRawAnswers = [];

        // === 3. RENDERING FUNCTIONS ===

        // Function to render all quiz questions
        function renderQuiz() {
            const questionType2inputType = {
                'single': 'radio',
                'multi': 'checkbox',
                'text': 'text'
            };
            questionsArea.innerHTML = '';
            quizData.forEach(q => {
                const questionElement = document.createElement('div');
                questionElement.className = 'question-block p-4 bg-gray-50 rounded-lg border border-gray-200';
                questionElement.id = q.id;

                const title = `<h3 class="text-lg font-semibold text-gray-800 mb-3">${q.questionText}</h3>`;
                let answersHtml = '';

                if (q.type == 'text') {
                    answersHtml += `
                        <input type="${questionType2inputType[q.type]}" name="${q.id}" class="w-full p-3 border border-gray-300 rounded-md text-gray-700 focus:border-indigo-500 focus:ring-indigo-500" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –æ—Ç–≤–µ—Ç –∑–¥–µ—Å—å">
                    `;
                } else if (q.type == 'single' || q.type == 'multi') {
                    q.answers.forEach((a) => {
                        const inputType = questionType2inputType[q.type] || 'text';
                        // FIX: ADD data-answer-text attribute to store the selected text
                        const sanitizedText = a.text.replace(/"/g, '&quot;');
                        
                        answersHtml += `
                            <label class="answer-option block mb-2 cursor-pointer">
                                <input type="${inputType}" name="${q.id}" data-points="${a.value}" data-answer-text="${sanitizedText}" ${a.recommendationTag ? `data-tag="${a.recommendationTag}"` : ''} class="hidden">
                                <div class="answer-label p-3 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-100 transition duration-150 ease-in-out">
                                    ${a.text}
                                </div>
                            </label>
                        `;
                    });
                }

                questionElement.innerHTML = title + answersHtml;
                questionsArea.appendChild(questionElement);
            });
            addCustomInputListeners(); 
        }

        // Helper to add custom listeners for visual styling on select/deselect
        function addCustomInputListeners() {
            document.querySelectorAll('.answer-option input[type="radio"], .answer-option input[type="checkbox"]').forEach(input => {
                const labelDiv = input.closest('label').querySelector('.answer-label');

                const updateStyle = () => {
                    if (input.checked) {
                        // Style for checked state
                        labelDiv.classList.add('bg-indigo-100', 'border-indigo-500', 'ring-2', 'ring-indigo-500');
                        labelDiv.classList.remove('bg-gray-50', 'border-gray-300');
                    } else {
                        // Style for unchecked state
                        labelDiv.classList.remove('bg-indigo-100', 'border-indigo-500', 'ring-2', 'ring-indigo-500');
                        labelDiv.classList.add('bg-gray-50', 'border-gray-300');
                    }
                };

                // Initial update and on change
                updateStyle();
                input.addEventListener('change', updateStyle);

                // For radio buttons, uncheck all others when one is selected
                if (input.type === 'radio') {
                    input.addEventListener('change', () => {
                        if (input.checked) {
                            document.querySelectorAll(`input[name="${input.name}"][type="radio"]`).forEach(otherInput => {
                                if (otherInput !== input) {
                                    otherInput.closest('label').querySelector('.answer-label').classList.remove('bg-indigo-100', 'border-indigo-500', 'ring-2', 'ring-indigo-500');
                                    otherInput.closest('label').querySelector('.answer-label').classList.add('bg-gray-50', 'border-gray-300');
                                }
                            });
                        }
                    });
                }
            });
        }


        // === 4. LOGIC FUNCTIONS ===

        // Collects all raw answers given by the user for backend submission AND local display
        function collectRawAnswers() {
            const rawAnswers = [];
            quizData.forEach(q => {
                let answers = [];

                if (q.type === 'text') {
                    const textInput = document.querySelector(`input[name="${q.id}"][type="text"]`);
                    const textValue = textInput ? textInput.value.trim() : '';

                    if (textValue) {
                        // –î–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤, —Å–∞–º —Ç–µ–∫—Å—Ç —è–≤–ª—è–µ—Ç—Å—è –æ—Ç–≤–µ—Ç–æ–º
                        answers.push({
                            text: textValue,
                            points: 0, 
                            tag: null
                        });
                    }

                } else if (q.type === 'single' || q.type === 'multi') {
                    // –î–ª—è radio/checkbox –∏—â–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
                    const selected = document.querySelectorAll(`input[name="${q.id}"]:checked`);
                    
                    answers = Array.from(selected).map(input => ({
                        // –¢–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞ –±–µ—Ä–µ—Ç—Å—è –∏–∑ data-answer-text
                        text: input.getAttribute('data-answer-text'), 
                        points: parseInt(input.getAttribute('data-points'), 10),
                        tag: input.getAttribute('data-tag') || null
                    }));
                }
                
                rawAnswers.push({
                    questionId: q.id,
                    questionText: q.questionText,
                    category: q.category,
                    type: q.type,
                    optional: !!q.optional,
                    answers: answers
                });
            });
            return rawAnswers;
        }


        // Validates that all questions have at least one answer selected
        function validateQuiz() {
            let isValid = true;
            quizData.forEach(q => {
                const questionBlock = document.getElementById(q.id);
                // Reset border class for all questions
                if (questionBlock) questionBlock.classList.remove('border-red-400', 'border-2');
                
                // Only validate if the question is NOT optional
                if (!q.optional) {
                    switch (q.type) {
                        case 'text':
                            const textInput = document.querySelector(`input[name="${q.id}"]`);
                            if (!textInput || !textInput.value.trim()) {
                                isValid = false;
                                if (textInput) textInput.classList.add('border-red-400', 'border-2'); // Highlight problem input
                            } else {
                                textInput.classList.remove('border-red-400', 'border-2');
                            }
                            break;
                        case 'single':
                        case 'multi':
                            // Check if any element with the question's name is checked
                            const selected = document.querySelectorAll(`input[name="${q.id}"]:checked`);
                            if (selected.length === 0) {
                                isValid = false;
                                if (questionBlock) questionBlock.classList.add('border-red-400', 'border-2'); // Highlight problem block
                            }
                            break;
                    }
                }
            });
            return isValid;
        }

        // Calculates total score, max possible score, and collects unique problem tags
        // --- UPDATED to accept raw answers as input instead of reading from DOM ---
        function calculateResults(rawAnswers) {
            let totalScore = 0;
            const uniqueRecommendations = new Set();
            let maxPossibleScore = 0;

            rawAnswers.forEach(rawQ => {
                // Find original question data for max score calculation
                const qData = quizData.find(q => q.id === rawQ.questionId);
                
                if (!qData) return; // Skip if question data is missing

                let questionMaxScore = 0;

                // Calculate max possible score for the question
                if (qData.type === 'single') {
                    // For single-select, max score is the maximum value among all possible answers
                    qData.answers.forEach(a => { questionMaxScore = Math.max(questionMaxScore, a.value); });
                } else if (qData.type === 'multi') {
                    // For multi-select, max score is the sum of all positive values
                    qData.answers.forEach(a => { questionMaxScore += a.value > 0 ? a.value : 0; });
                }
                // Text fields (type 'text') do not contribute to max score (questionMaxScore remains 0)

                maxPossibleScore += questionMaxScore;

                // Sum selected answers and collect tags from the raw answers
                // rawQ.answers contains the parsed data from the user's selection/input
                rawQ.answers.forEach(answer => {
                    // Only add points and tags if the answer has them (i.e., not a text field)
                    if (answer.points > 0 || answer.points < 0) {
                        totalScore += answer.points;
                    }

                    if (answer.tag) {
                        uniqueRecommendations.add(answer.tag);
                    }
                });
            });

            return { totalScore, maxPossibleScore, recommendations: Array.from(uniqueRecommendations) };
        }
        // --- END OF calculateResults UPDATE ---

        // Displays the calculated results on the screen
        function displayResults(results) {
            quizContainer.classList.add('hidden');
            resultsContainer.classList.remove('hidden');

            const scorePercentage = (results.totalScore / results.maxPossibleScore) * 100;

            // 1. Global Recommendation Logic (using globalScoreConfig)
            const globalRecConfig = globalScoreConfig
                .sort((a, b) => b.minPercentage - a.minPercentage) 
                .find(config => scorePercentage >= config.minPercentage);

            finalScoreDisplay.classList.remove('text-green-600', 'text-yellow-600', 'text-red-600', 'text-gray-600');
            
            if (globalRecConfig) {
                finalScoreDisplay.classList.add(globalRecConfig.colorClass);
                
                const templateElement = document.getElementById(globalRecConfig.templateId);
                globalRecommendationDisplay.innerHTML = templateElement ? templateElement.innerHTML : 'Template error.';
            } else {
                finalScoreDisplay.classList.add('text-gray-600');
                globalRecommendationDisplay.textContent = 'Calculation error.';
            }

            finalScoreDisplay.textContent = `${results.totalScore} / ${results.maxPossibleScore} (${scorePercentage.toFixed(0)}%)`;

            // 2. Display Detailed Answers (HTML)
            displayDetailedAnswers(cachedRawAnswers);

            // 3. Display Specific Recommendations
            recommendationsList.innerHTML = '';
            
            if (results.recommendations.length > 0) {
                suggestionsContainer.classList.remove('hidden');
                noProblemsMessage.classList.add('hidden');
                
                results.recommendations.forEach(tag => {
                    const templateId = 'rec-' + tag;
                    const recElement = document.getElementById(templateId);

                    const listItem = document.createElement('li');
                    listItem.className = 'p-3 bg-red-50 border-l-4 border-red-500 rounded-lg text-gray-700';

                    if (recElement) {
                        listItem.innerHTML = recElement.innerHTML; 
                    } else {
                        listItem.textContent = 'Unknown recommendation tag: ' + tag;
                    }
                    recommendationsList.appendChild(listItem);
                });
            } else {
                suggestionsContainer.classList.add('hidden');
                noProblemsMessage.classList.remove('hidden');
            }
        }

        function displayDetailedAnswers(rawAnswers) {
            answersList.innerHTML = '';
            
            rawAnswers.forEach((q, index) => {
                const answerText = q.answers.map(a => a.text).join('; ');

                const listItem = document.createElement('li');
                listItem.className = 'p-3 border-b border-gray-100 last:border-b-0';
                
                if (q.answers.length > 0) {
                    listItem.innerHTML = `
                        <p class="font-semibold text-gray-800">#${index + 1}: ${q.questionText}</p>
                        <p class="mt-1 text-gray-600 italic">–û—Ç–≤–µ—Ç: ${answerText}</p>
                    `;
                } else {
                    const statusText = q.optional ? '–ü—Ä–æ–ø—É—â–µ–Ω (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π)' : '–ù–µ –≤—ã–±—Ä–∞–Ω / –ü—É—Å—Ç–æ';
                    listItem.innerHTML = `
                        <p class="font-semibold text-gray-800">#${index + 1}: ${q.questionText}</p>
                        <p class="mt-1 text-red-500 italic">–û—Ç–≤–µ—Ç: ${statusText}</p>
                    `;
                }
                answersList.appendChild(listItem);
            });
        }
        
        // Creates a clean, formatted text string of the results for clipboard
        function generateResultsText() {
            const scoreText = finalScoreDisplay.textContent;
            const globalRecHtml = globalRecommendationDisplay.innerHTML;

            // Extract main global recommendation text from the template (removing HTML tags)
            const globalRecContainer = document.createElement('div');
            globalRecContainer.innerHTML = globalRecHtml;
            const globalRecTitle = globalRecContainer.querySelector('h3') ? globalRecContainer.querySelector('h3').textContent : '–û–±—â–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è';
            const globalRecParagraph = globalRecContainer.querySelector('p') ? globalRecContainer.querySelector('p').textContent : '';

            let resultText = `--- –û–¢–ß–ï–¢ –û –ü–†–û–•–û–ñ–î–ï–ù–ò–ò –û–ü–†–û–°–ù–ò–ö–ê ---\n`;
            resultText += `–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è: ${new Date().toLocaleString('ru-RU')}\n`;
            resultText += `\n--- –ò–ù–î–ï–ö–° –°–ê–ú–û–ß–£–í–°–¢–í–ò–Ø ---\n`;
            resultText += `–û–±—â–∏–π –±–∞–ª–ª: ${scoreText}\n`;
            resultText += `\n${globalRecTitle}\n`;
            resultText += `${globalRecParagraph}\n`;

            // 1. Detailed Answers Section (NEW)
            resultText += `\n\n--- –ü–û–î–†–û–ë–ù–´–ï –û–¢–í–ï–¢–´ ---\n`;
            cachedRawAnswers.forEach((q, index) => {
                // Join all selected/entered answer texts
                const answerText = q.answers.map(a => a.text).join('; ');

                resultText += `\n–í–æ–ø—Ä–æ—Å #${index + 1} (${q.type}): ${q.questionText.trim()}\n`;

                if (q.answers.length > 0) {
                    resultText += `   –û—Ç–≤–µ—Ç: ${answerText}\n`;
                } else {
                    const statusText = q.optional ? '–ü—Ä–æ–ø—É—â–µ–Ω (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π)' : '–ù–µ –≤—ã–±—Ä–∞–Ω / –û—Å—Ç–∞–≤–ª–µ–Ω –ø—É—Å—Ç—ã–º';
                    resultText += `   –û—Ç–≤–µ—Ç: ${statusText}\n`;
                }
            });


            // 2. Specific Recommendations Section
            resultText += `\n\n--- –°–ü–ï–¶–ò–§–ò–ß–ï–°–ö–ò–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò ---\n`;

            if (recommendationsList.children.length > 0) {
                
                Array.from(recommendationsList.children).forEach((li, index) => {
                    const strongText = li.querySelector('strong') ? li.querySelector('strong').textContent : `–ü—É–Ω–∫—Ç ${index + 1}:`;
                    resultText += `\n${strongText}\n`;
                    // Convert list items to clean bullet points
                    const listItems = Array.from(li.querySelectorAll('ul li')).map(item => `   ‚Ä¢ ${item.textContent.trim()}`).join('\n');
                    const generalText = li.querySelector('p') ? li.querySelector('p').textContent : '';
                    resultText += `${generalText}\n`;
                    if (listItems) {
                        resultText += `${listItems}\n`;
                    }
                });
            } else {
                 resultText += noProblemsMessage.textContent;
            }

            return resultText;
        }

        // Copies the generated text to the clipboard
        function copyResultsToClipboard() {
            const textToCopy = generateResultsText();
            const tempTextArea = document.createElement('textarea');
            tempTextArea.style.position = 'fixed';
            tempTextArea.style.opacity = '0';
            tempTextArea.value = textToCopy;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showShareStatus('–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞! –ü—Ä–æ—Å—Ç–æ –≤—Å—Ç–∞–≤—å—Ç–µ –∏—Ö –≤ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä.');
                } else {
                    // Updated error message as PDF print is removed
                    showShareStatus('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–æ—á–µ—Ç–∞–Ω–∏–µ –∫–ª–∞–≤–∏—à Ctrl+C / Cmd+C.', true);
                }
            } catch (err) {
                console.error('Fallback: Copy command failed', err);
                // Updated error message as PDF print is removed
                showShareStatus('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–æ—á–µ—Ç–∞–Ω–∏–µ –∫–ª–∞–≤–∏—à Ctrl+C / Cmd+C.', true);
            }
            document.body.removeChild(tempTextArea);
        }

        // printResults() function REMOVED


        // Display temporary success/error messages after sharing attempts
        function showShareStatus(message, isError = false) {
            shareStatus.textContent = message;
            shareStatus.classList.remove('hidden', 'text-green-600', 'text-red-500');
            shareStatus.classList.add(isError ? 'text-red-500' : 'text-green-600');

            setTimeout(() => {
                shareStatus.classList.add('hidden');
            }, 5000);
        }


        // === 5. EVENT HANDLERS ===

        // Quiz submission handler
        submitButton.addEventListener('click', async () => {
            if (validateQuiz()) {
                errorMessage.classList.add('hidden');
                
                // 1. Collect answers once
                const rawAnswers = collectRawAnswers();
                cachedRawAnswers = rawAnswers; 
                
                // 2. Calculate results using collected answers
                const results = calculateResults(rawAnswers);

                // 3. Display results to user (Client side)
                displayResults(results);

            } else {
                errorMessage.classList.remove('hidden');
                // Scroll to the first unanswered question
                const firstInvalid = document.querySelector('.question-block.border-red-400, input.border-red-400');
                if (firstInvalid) {
                    firstInvalid.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
        });

        // Copy Results Handler
        copyResultsButton.addEventListener('click', copyResultsToClipboard);

        // Print Results Handler REMOVED


        // Quiz reset handler
        resetButton.addEventListener('click', () => {
            resultsContainer.classList.add('hidden');
            quizContainer.classList.remove('hidden');
            // Assuming submissionStatus is visible, hide it.
            const submissionStatus = document.getElementById('submission-status');
            if (submissionStatus) submissionStatus.classList.add('hidden');
            window.location.reload(); 
        });
        
        // Initialization on window load
        window.onload = renderQuiz;

        </script>
</body>

</html>
